<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shellder - Aegis AIO Control Panel</title>
    <link rel="stylesheet" href="/static/style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600&family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- xterm.js for interactive terminal -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/xterm@5.3.0/css/xterm.css">
    <script src="https://cdn.jsdelivr.net/npm/xterm@5.3.0/lib/xterm.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xterm-addon-fit@0.8.0/lib/xterm-addon-fit.min.js"></script>
</head>
<body>
    <div class="app">
        <!-- Sidebar -->
        <nav class="sidebar">
            <div class="logo">
                <div class="logo-icon">üêö</div>
                <div class="logo-text">
                    <span class="logo-name">Shellder</span>
                    <span class="logo-version">v1.0</span>
                </div>
            </div>
            
            <div class="nav-section">
                <div class="nav-label">Overview</div>
                <a href="#" class="nav-item active" data-page="dashboard" onclick="navigateTo('dashboard'); return false;">
                    <span class="nav-icon">üìä</span>
                    <span>Dashboard</span>
                </a>
                <a href="#" class="nav-item" data-page="containers" onclick="navigateTo('containers'); return false;">
                    <span class="nav-icon">üê≥</span>
                    <span>Containers</span>
                </a>
                <a href="#" class="nav-item" data-page="setup" onclick="navigateTo('setup'); return false;">
                    <span class="nav-icon">‚öôÔ∏è</span>
                    <span>Setup & Config</span>
                </a>
            </div>
            
            <div class="nav-section">
                <div class="nav-label">Monitoring</div>
                <a href="#" class="nav-item" data-page="devices" onclick="navigateTo('devices'); return false;">
                    <span class="nav-icon">üì±</span>
                    <span>Devices</span>
                </a>
                <a href="#" class="nav-item" data-page="stack" onclick="navigateTo('stack'); return false;">
                    <span class="nav-icon">üéÆ</span>
                    <span>Stack Data</span>
                </a>
                <a href="#" class="nav-item" data-page="xilriws" onclick="navigateTo('xilriws'); return false;">
                    <span class="nav-icon">üîê</span>
                    <span>Xilriws</span>
                </a>
                <a href="#" class="nav-item" data-page="stats" onclick="navigateTo('stats'); return false;">
                    <span class="nav-icon">üìà</span>
                    <span>Statistics</span>
                </a>
            </div>
            
            <div class="nav-section">
                <div class="nav-label">Management</div>
                <a href="#" class="nav-item" data-page="nginx" onclick="navigateTo('nginx'); return false;">
                    <span class="nav-icon">üîê</span>
                    <span>Sites & Security</span>
                </a>
                <a href="#" class="nav-item" data-page="files" onclick="navigateTo('files'); return false;">
                    <span class="nav-icon">üìÅ</span>
                    <span>Files</span>
                </a>
                <a href="#" class="nav-item" data-page="scripts" onclick="navigateTo('scripts'); return false;">
                    <span class="nav-icon">‚ö°</span>
                    <span>Scripts</span>
                </a>
                <a href="#" class="nav-item" data-page="logs" onclick="navigateTo('logs'); return false;">
                    <span class="nav-icon">üìú</span>
                    <span>Logs</span>
                </a>
                <a href="#" class="nav-item" data-page="updates" onclick="navigateTo('updates'); return false;">
                    <span class="nav-icon">üîÑ</span>
                    <span>Updates</span>
                </a>
            </div>
            
            <div class="sidebar-footer">
                <div class="status-indicator" onclick="toggleDebugPanel()" style="cursor: pointer;" title="Click to toggle debug panel">
                    <span class="status-dot" id="connectionStatus"></span>
                    <span id="connectionText">Connecting...</span>
                </div>
                <div id="debugPanel" style="display: none; font-size: 10px; margin-top: 8px; padding: 8px; background: rgba(0,0,0,0.5); border-radius: 4px; max-height: 300px; overflow-y: auto;">
                    <div style="margin-bottom: 6px; font-weight: bold; color: #f59e0b;">üîß Debug Panel (AI-Friendly)</div>
                    <div>JS: <span id="debugJS">checking...</span></div>
                    <div>API: <span id="debugAPI">checking...</span></div>
                    <div>WS: <span id="debugWS">checking...</span></div>
                    <div>Client Logs: <span id="debugLogCount">0</span></div>
                    <div style="margin-top: 8px; display: flex; flex-direction: column; gap: 4px;">
                        <button onclick="SHELLDER_DEBUG.copyToClipboard()" style="font-size: 10px; padding: 4px 8px; cursor: pointer;">üìã Copy Client Logs</button>
                        <button onclick="SHELLDER_DEBUG.download()" style="font-size: 10px; padding: 4px 8px; cursor: pointer;">üíæ Download Client</button>
                        <button onclick="SHELLDER_DEBUG.sendToServer()" style="font-size: 10px; padding: 4px 8px; cursor: pointer;">üì§ Send to Server</button>
                        <button onclick="downloadServerDebugLog()" style="font-size: 10px; padding: 4px 8px; cursor: pointer; background: #f59e0b; color: black;">üì• Download debuglog.txt</button>
                        <button onclick="viewDebugLog()" style="font-size: 10px; padding: 4px 8px; cursor: pointer;">üëÅÔ∏è View Server Log</button>
                    </div>
                    <div style="margin-top: 6px; font-size: 9px; color: #888;">
                        <b>For AI debugging:</b><br>
                        ‚Ä¢ debuglog.txt in Shellder/<br>
                        ‚Ä¢ Contains ALL server + client logs<br>
                        ‚Ä¢ Auto-synced every 30s<br>
                        ‚Ä¢ Console: SD.export()
                    </div>
                </div>
            </div>
        </nav>
        
        <!-- Main Content -->
        <main class="main-content">
            <header class="header">
                <h1 id="pageTitle">Dashboard</h1>
                <div class="header-actions">
                    <button class="btn btn-icon" onclick="refreshData()" title="Refresh">üîÑ</button>
                    <span class="last-update" id="lastUpdate">--</span>
                </div>
            </header>
            
            <!-- Dashboard Page -->
            <div id="page-dashboard" class="page active">
                <div class="stats-grid stats-grid-5">
                    <div class="stat-card" title="Number of Docker containers currently running">
                        <div class="stat-icon running">üü¢</div>
                        <div class="stat-info">
                            <div class="stat-value" id="containersRunning">-</div>
                            <div class="stat-label">Containers Running</div>
                        </div>
                    </div>
                    <div class="stat-card" title="Number of Docker containers that are stopped">
                        <div class="stat-icon stopped">üî¥</div>
                        <div class="stat-info">
                            <div class="stat-value" id="containersStopped">-</div>
                            <div class="stat-label">Containers Stopped</div>
                        </div>
                    </div>
                    <div class="stat-card clickable" onclick="showMetricDetail('cpu')" title="CPU usage - click for history">
                        <div class="stat-icon cpu">‚ö°</div>
                        <div class="stat-info">
                            <div class="stat-value" id="cpuUsed">-</div>
                            <div class="stat-label">CPU Usage</div>
                            <div class="stat-sparkline" id="cpuSparkline"></div>
                        </div>
                    </div>
                    <div class="stat-card clickable" onclick="showMetricDetail('memory')" title="System RAM usage - click for history">
                        <div class="stat-icon memory">üß†</div>
                        <div class="stat-info">
                            <div class="stat-value" id="memoryUsed">-</div>
                            <div class="stat-label">RAM Usage</div>
                            <div class="stat-sparkline" id="memorySparkline"></div>
                        </div>
                    </div>
                    <div class="stat-card clickable" onclick="showMetricDetail('disk')" title="Hard drive storage usage - click for history">
                        <div class="stat-icon disk">üíΩ</div>
                        <div class="stat-info">
                            <div class="stat-value" id="diskUsed">-</div>
                            <div class="stat-label">Disk Usage</div>
                            <div class="stat-sparkline" id="diskSparkline"></div>
                        </div>
                    </div>
                </div>
                
                <div class="dashboard-grid">
                    <div class="card">
                        <div class="card-header">
                            <h2>üéÆ Quick Actions</h2>
                        </div>
                        <div class="card-body">
                            <div class="action-grid">
                                <button class="action-btn" onclick="dockerAction('up')" title="Start all Docker containers (docker compose up -d)">
                                    <span class="action-icon">‚ñ∂Ô∏è</span>
                                    <span>Start All Containers</span>
                                </button>
                                <button class="action-btn" onclick="dockerAction('down')" title="Stop all Docker containers (docker compose down)">
                                    <span class="action-icon">‚èπÔ∏è</span>
                                    <span>Stop All Containers</span>
                                </button>
                                <button class="action-btn" onclick="dockerAction('restart')" title="Restart all Docker containers">
                                    <span class="action-icon">üîÑ</span>
                                    <span>Restart All Containers</span>
                                </button>
                                <button class="action-btn" onclick="dockerAction('pull')" title="Download latest container images from Docker Hub">
                                    <span class="action-icon">‚¨áÔ∏è</span>
                                    <span>Update Images</span>
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card-header">
                            <h2>üñ•Ô∏è Server Status</h2>
                        </div>
                        <div class="card-body">
                            <div class="info-list">
                                <div class="info-item" title="How long your server has been running since last restart">
                                    <span class="info-label">‚è±Ô∏è Server Uptime</span>
                                    <span class="info-value" id="systemUptime">-</span>
                                </div>
                                <div class="info-item" title="RAM memory usage (used / total)">
                                    <span class="info-label">üß† RAM (Used/Total)</span>
                                    <span class="info-value" id="memoryInfo">-</span>
                                </div>
                                <div class="info-item" title="Hard disk storage usage (used / total)">
                                    <span class="info-label">üíΩ Disk (Used/Total)</span>
                                    <span class="info-value" id="diskInfo">-</span>
                                </div>
                                <div class="info-item" title="Whether .env configuration file exists and is set up">
                                    <span class="info-label">‚öôÔ∏è .env Config</span>
                                    <span class="info-value" id="envStatus">-</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="dashboard-grid">
                    <div class="card">
                        <div class="card-header">
                            <h2>üê≥ Docker Containers</h2>
                        </div>
                        <div class="card-body">
                            <div id="containerList" class="container-list">
                                <div class="loading">Loading containers...</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card-header">
                            <h2 title="Xilriws handles Pokemon Go authentication - bypassing security checks">üîê Auth Proxy (Xilriws)</h2>
                        </div>
                        <div class="card-body">
                            <div id="xilriwsStats" class="xilriws-panel">
                                <div class="loading">Loading auth proxy stats...</div>
                            </div>
                            <div class="xilriws-details" id="xilriwsDetails">
                                <!-- Details populated by JS -->
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Disk Health Alert Banner (shown when disk is critical) -->
                <div id="diskAlertBanner" class="alert-banner alert-critical" style="display: none;">
                    <div class="alert-content">
                        <span class="alert-icon">üö®</span>
                        <span class="alert-message" id="diskAlertMessage">Disk space critical!</span>
                        <button class="btn btn-sm btn-warning" onclick="showDiskHealthPanel()">View Details</button>
                        <button class="btn btn-sm" onclick="hideDiskAlert()">Dismiss</button>
                    </div>
                </div>
                
                <div class="dashboard-grid" style="margin-top: 1rem;">
                    <!-- Combined System Resources Panel -->
                    <div class="card system-resources-card" id="systemResourcesCard">
                        <div class="card-header">
                            <h2 title="Monitor and manage system resources">‚ö° System Resources</h2>
                            <div class="card-actions">
                                <span id="diskHealthStatus" class="badge badge-success" title="Disk status">üíæ --</span>
                                <span id="memoryHealthStatus" class="badge badge-success" title="Memory status">üß† --</span>
                                <button class="btn btn-sm" onclick="loadSystemResources()" title="Refresh all">üîÑ</button>
                            </div>
                        </div>
                        <div class="card-body">
                            <!-- Resource Tabs -->
                            <div class="resource-tabs">
                                <button class="resource-tab active" onclick="showResourceTab('disk')" id="tabDisk">
                                    üíæ Disk
                                </button>
                                <button class="resource-tab" onclick="showResourceTab('memory')" id="tabMemory">
                                    üß† Memory
                                </button>
                                <button class="resource-tab" onclick="showResourceTab('processes')" id="tabProcesses">
                                    üìä Processes
                                </button>
                            </div>
                            
                            <!-- Disk Tab Content -->
                            <div class="resource-content" id="resourceDisk">
                                <div class="resource-bars">
                                    <div class="resource-bar-group">
                                        <div class="resource-bar-label">
                                            <span>üíæ Disk</span>
                                            <span id="diskHealthPercent">--%</span>
                                        </div>
                                        <div class="resource-bar-container">
                                            <div class="resource-bar disk" id="diskUsageBar" style="width: 0%"></div>
                                        </div>
                                        <div class="resource-bar-stats">
                                            <span id="diskHealthUsed">--</span> / <span id="diskHealthTotal">--</span>
                                            <span class="resource-free">(<span id="diskHealthFree">--</span> free)</span>
                                        </div>
                                    </div>
                                </div>
                                <div id="diskGrowthWarning" class="resource-warning" style="display: none;">
                                    <span>‚ö†Ô∏è</span>
                                    <span id="diskGrowthMessage">Disk growing rapidly!</span>
                                </div>
                                <div class="resource-actions">
                                    <button class="btn btn-sm" onclick="scanLargeFiles()" title="Find files over 100MB">üîç Large Files</button>
                                    <button class="btn btn-sm" onclick="detectBloat()" title="Detect known bloat">üóëÔ∏è Bloat</button>
                                    <button class="btn btn-sm btn-warning" onclick="cleanupAllSafe()" title="Clean all safe bloat">üßπ Cleanup</button>
                                </div>
                                <div id="diskScanResults" class="resource-scan-results" style="display: none;"></div>
                            </div>
                            
                            <!-- Memory Tab Content -->
                            <div class="resource-content" id="resourceMemory" style="display: none;">
                                <div class="resource-bars">
                                    <div class="resource-bar-group">
                                        <div class="resource-bar-label">
                                            <span>üß† RAM</span>
                                            <span id="ramPercent">--%</span>
                                        </div>
                                        <div class="resource-bar-container">
                                            <div class="resource-bar memory" id="ramUsageBar" style="width: 0%"></div>
                                        </div>
                                        <div class="resource-bar-stats">
                                            <span id="ramUsed">--</span> / <span id="ramTotal">--</span>
                                            <span class="resource-free">(<span id="ramAvailable">--</span> avail)</span>
                                        </div>
                                    </div>
                                    <div class="resource-bar-group">
                                        <div class="resource-bar-label">
                                            <span>üíø Swap</span>
                                            <span id="swapPercent">--%</span>
                                        </div>
                                        <div class="resource-bar-container swap">
                                            <div class="resource-bar swap" id="swapUsageBar" style="width: 0%"></div>
                                        </div>
                                        <div class="resource-bar-stats">
                                            <span id="swapUsed">--</span> / <span id="swapTotal">--</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="resource-cache-info">
                                    üíæ Clearable cache: <strong id="memoryClearable">--</strong>
                                </div>
                                <div class="resource-actions">
                                    <button class="btn btn-sm btn-warning" onclick="clearMemoryCache()" title="Clear RAM cache">üßπ Clear Cache</button>
                                    <button class="btn btn-sm btn-danger" onclick="emergencyMemoryCleanup()" title="Kill high memory processes">üö® Emergency</button>
                                </div>
                            </div>
                            
                            <!-- Processes Tab Content -->
                            <div class="resource-content" id="resourceProcesses" style="display: none;">
                                <div class="process-controls">
                                    <span class="process-sort-label">Sort by:</span>
                                    <button class="process-sort-btn active" onclick="loadProcessList('memory')" id="sortMemory">Memory</button>
                                    <button class="process-sort-btn" onclick="loadProcessList('cpu')" id="sortCpu">CPU</button>
                                </div>
                                <div id="processListContainer" class="process-list-compact">
                                    <div class="loading">Click to load processes...</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card-header">
                            <h2 title="System services required for the Aegis stack to function">üîå System Services</h2>
                            <div class="card-actions">
                                <span id="servicesStatus" class="badge badge-info">Loading...</span>
                            </div>
                        </div>
                        <div class="card-body">
                            <div id="servicesList" class="services-grid">
                                <div class="loading">Checking system services...</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card-header">
                            <h2 title="Web service availability - checks if your sites are responding">üåê Site Availability</h2>
                            <div class="card-actions">
                                <button class="btn btn-sm" onclick="checkSiteAvailability()">üîÑ Check</button>
                            </div>
                        </div>
                        <div class="card-body">
                            <div id="siteAvailability" class="site-availability-grid">
                                <div class="loading">Checking site availability...</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- AI Debug Panel -->
                    <div class="card debug-panel-card">
                        <div class="card-header">
                            <h2 title="Live debug panel for AI-assisted debugging">ü§ñ AI Debug Panel</h2>
                            <div class="card-actions">
                                <span id="debugVersion" class="badge badge-info">v--</span>
                                <span id="debugCommit" class="badge badge-secondary">--</span>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="debug-controls">
                                <button class="btn btn-primary" onclick="debugPullAndRestart()" title="Pull from GitHub and restart service">
                                    üöÄ Pull & Restart
                                </button>
                                <button class="btn btn-secondary" onclick="debugGitPull()" title="Pull from GitHub only">
                                    ‚¨áÔ∏è Git Pull
                                </button>
                                <button class="btn btn-warning" onclick="debugRestart()" title="Restart service only">
                                    üîÑ Restart
                                </button>
                                <button class="btn btn-sm" onclick="refreshDebugLogs()" title="Refresh logs">
                                    üìã Refresh Logs
                                </button>
                            </div>
                            <div class="debug-status" id="debugStatus">
                                <span class="debug-uptime">‚è±Ô∏è Uptime: <span id="debugUptime">--</span></span>
                                <span class="debug-pid">PID: <span id="debugPid">--</span></span>
                            </div>
                            <div class="debug-log-container">
                                <div class="debug-log-header">
                                    <span>üìú Live Debug Log</span>
                                    <label class="debug-autoscroll">
                                        <input type="checkbox" id="debugAutoRefresh" checked> Auto-refresh
                                    </label>
                                </div>
                                <div id="debugLogOutput" class="debug-log-output">
                                    <div class="loading">Loading debug logs...</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Containers Page -->
            <div id="page-containers" class="page">
                <!-- Docker Health Monitor -->
                <div class="docker-health-card card">
                    <div class="card-header">
                        <h2>ü©∫ Docker Health Monitor</h2>
                        <div class="card-actions">
                            <button class="btn btn-sm" onclick="loadDockerHealth()" title="Refresh health status">üîÑ Refresh</button>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="docker-health-grid" id="dockerHealthGrid">
                            <!-- Docker Daemon Status -->
                            <div class="health-status-item" id="dockerDaemonStatus">
                                <div class="health-icon">üê≥</div>
                                <div class="health-info">
                                    <div class="health-title">Docker Daemon</div>
                                    <div class="health-status-text">Checking...</div>
                                </div>
                                <div class="health-indicator checking"></div>
                            </div>
                            
                            <!-- Docker Compose Status -->
                            <div class="health-status-item" id="dockerComposeStatus">
                                <div class="health-icon">üì¶</div>
                                <div class="health-info">
                                    <div class="health-title">Docker Compose</div>
                                    <div class="health-status-text">Checking...</div>
                                </div>
                                <div class="health-indicator checking"></div>
                            </div>
                            
                            <!-- Docker Network Status -->
                            <div class="health-status-item" id="dockerNetworkStatus">
                                <div class="health-icon">üåê</div>
                                <div class="health-info">
                                    <div class="health-title">Docker Networks</div>
                                    <div class="health-status-text">Checking...</div>
                                </div>
                                <div class="health-indicator checking"></div>
                            </div>
                            
                            <!-- Docker Volumes Status -->
                            <div class="health-status-item" id="dockerVolumesStatus">
                                <div class="health-icon">üíæ</div>
                                <div class="health-info">
                                    <div class="health-title">Docker Volumes</div>
                                    <div class="health-status-text">Checking...</div>
                                </div>
                                <div class="health-indicator checking"></div>
                            </div>
                        </div>
                        
                        <!-- Port Accessibility Section -->
                        <div class="port-health-section">
                            <div class="port-health-header">
                                <h3>üîå Container Port Accessibility</h3>
                                <button class="btn btn-sm" onclick="checkAllContainerPorts()" title="Check all container ports">üîç Check Ports</button>
                            </div>
                            <div class="port-health-hint">
                                <span class="hint-icon">üí°</span>
                                <span>Checks if each container's internal port is accessible. Green = healthy, Red = unreachable.</span>
                            </div>
                            <div class="port-health-grid" id="portHealthGrid">
                                <div class="loading">Click "Check Ports" to scan container accessibility</div>
                            </div>
                        </div>
                        
                        <!-- Additional Docker Info -->
                        <div class="docker-info-section" id="dockerInfoSection">
                            <div class="docker-info-row">
                                <span class="info-label">üè† Docker Root:</span>
                                <span class="info-value" id="dockerRoot">--</span>
                            </div>
                            <div class="docker-info-row">
                                <span class="info-label">üìä Docker Version:</span>
                                <span class="info-value" id="dockerVersion">--</span>
                            </div>
                            <div class="docker-info-row">
                                <span class="info-label">üñ•Ô∏è Compose File:</span>
                                <span class="info-value" id="composeFile">--</span>
                            </div>
                            <div class="docker-info-row">
                                <span class="info-label">üìà Total Images:</span>
                                <span class="info-value" id="totalImages">--</span>
                            </div>
                            <div class="docker-info-row">
                                <span class="info-label">üíø Docker Disk Usage:</span>
                                <span class="info-value" id="dockerDiskUsage">--</span>
                            </div>
                        </div>
                        
                        <!-- Docker Installation Section -->
                        <div class="docker-install-section">
                            <div class="docker-install-header">
                                <h3>üîß Docker Installation & Service</h3>
                                <div class="docker-service-controls">
                                    <button class="btn btn-sm btn-success" onclick="dockerServiceAction('start')" title="Start Docker service">‚ñ∂Ô∏è Start</button>
                                    <button class="btn btn-sm btn-warning" onclick="dockerServiceAction('restart')" title="Restart Docker service">üîÑ Restart</button>
                                    <button class="btn btn-sm btn-danger" onclick="dockerServiceAction('stop')" title="Stop Docker service">‚èπÔ∏è Stop</button>
                                </div>
                            </div>
                            <div class="docker-install-hint">
                                <span class="hint-icon">üí°</span>
                                <span>Install or update Docker components. Requires sudo access on the server.</span>
                            </div>
                            <div class="docker-install-grid">
                                <div class="docker-install-item" id="installDockerEngine">
                                    <div class="install-icon">üê≥</div>
                                    <div class="install-info">
                                        <div class="install-title">Docker Engine</div>
                                        <div class="install-desc">Container runtime & CLI</div>
                                        <div class="install-status" id="dockerEngineStatus">Checking...</div>
                                    </div>
                                    <button class="btn btn-sm btn-primary" onclick="installDockerComponent('engine')" title="Install Docker Engine">Install</button>
                                </div>
                                <div class="docker-install-item" id="installDockerCompose">
                                    <div class="install-icon">üì¶</div>
                                    <div class="install-info">
                                        <div class="install-title">Docker Compose</div>
                                        <div class="install-desc">Multi-container orchestration</div>
                                        <div class="install-status" id="dockerComposeInstallStatus">Checking...</div>
                                    </div>
                                    <button class="btn btn-sm btn-primary" onclick="installDockerComponent('compose')" title="Install Docker Compose">Install</button>
                                </div>
                                <div class="docker-install-item" id="installDockerBuildx">
                                    <div class="install-icon">üî®</div>
                                    <div class="install-info">
                                        <div class="install-title">Docker Buildx</div>
                                        <div class="install-desc">Extended build capabilities</div>
                                        <div class="install-status" id="dockerBuildxStatus">Checking...</div>
                                    </div>
                                    <button class="btn btn-sm btn-primary" onclick="installDockerComponent('buildx')" title="Install Docker Buildx">Install</button>
                                </div>
                                <div class="docker-install-item" id="installDockerAll">
                                    <div class="install-icon">üöÄ</div>
                                    <div class="install-info">
                                        <div class="install-title">Full Docker Setup</div>
                                        <div class="install-desc">Install all components + configure</div>
                                    </div>
                                    <button class="btn btn-sm btn-success" onclick="installDockerComponent('all')" title="Install complete Docker setup">Install All</button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Docker Configuration Files Section -->
                        <div class="docker-config-section">
                            <div class="docker-config-header">
                                <h3>üìÅ Docker Configuration Files</h3>
                                <button class="btn btn-sm" onclick="loadDockerConfigs()" title="Refresh config files">üîÑ Refresh</button>
                            </div>
                            <div class="docker-config-hint">
                                <span class="hint-icon">‚ö†Ô∏è</span>
                                <span>Edit Docker service configuration. Changes require Docker service restart to take effect.</span>
                            </div>
                            <div class="docker-config-grid" id="dockerConfigGrid">
                                <!-- Daemon.json -->
                                <div class="docker-config-item" onclick="editDockerConfig('daemon')">
                                    <div class="config-icon">‚öôÔ∏è</div>
                                    <div class="config-info">
                                        <div class="config-title">daemon.json</div>
                                        <div class="config-path">/etc/docker/daemon.json</div>
                                        <div class="config-desc">Docker daemon configuration (logging, storage, registry mirrors)</div>
                                    </div>
                                    <span class="config-status" id="daemonJsonStatus">--</span>
                                </div>
                                
                                <!-- Docker Service -->
                                <div class="docker-config-item" onclick="editDockerConfig('service')">
                                    <div class="config-icon">üîß</div>
                                    <div class="config-info">
                                        <div class="config-title">docker.service</div>
                                        <div class="config-path">/etc/systemd/system/docker.service.d/override.conf</div>
                                        <div class="config-desc">Systemd service overrides (environment, limits)</div>
                                    </div>
                                    <span class="config-status" id="dockerServiceStatus">--</span>
                                </div>
                                
                                <!-- Docker Compose Override -->
                                <div class="docker-config-item" onclick="editDockerConfig('compose-override')">
                                    <div class="config-icon">üìù</div>
                                    <div class="config-info">
                                        <div class="config-title">docker-compose.override.yml</div>
                                        <div class="config-path">Local compose overrides</div>
                                        <div class="config-desc">Override container settings without modifying main file</div>
                                    </div>
                                    <span class="config-status" id="composeOverrideStatus">--</span>
                                </div>
                                
                                <!-- Docker Environment -->
                                <div class="docker-config-item" onclick="editDockerConfig('env')">
                                    <div class="config-icon">üîë</div>
                                    <div class="config-info">
                                        <div class="config-title">.env (Docker)</div>
                                        <div class="config-path">Docker Compose environment variables</div>
                                        <div class="config-desc">Environment variables for compose services</div>
                                    </div>
                                    <span class="config-status" id="dockerEnvStatus">--</span>
                                </div>
                                
                                <!-- Registries Config -->
                                <div class="docker-config-item" onclick="editDockerConfig('registries')">
                                    <div class="config-icon">üèõÔ∏è</div>
                                    <div class="config-info">
                                        <div class="config-title">registries.conf</div>
                                        <div class="config-path">/etc/containers/registries.conf</div>
                                        <div class="config-desc">Container registry configuration</div>
                                    </div>
                                    <span class="config-status" id="registriesStatus">--</span>
                                </div>
                                
                                <!-- Docker Log Config -->
                                <div class="docker-config-item" onclick="editDockerConfig('logrotate')">
                                    <div class="config-icon">üìã</div>
                                    <div class="config-info">
                                        <div class="config-title">docker-logrotate</div>
                                        <div class="config-path">/etc/logrotate.d/docker</div>
                                        <div class="config-desc">Docker log rotation settings</div>
                                    </div>
                                    <span class="config-status" id="logrotateStatus">--</span>
                                </div>
                            </div>
                            
                            <!-- Config Editor (hidden by default) -->
                            <div class="docker-config-editor" id="dockerConfigEditor" style="display: none;">
                                <div class="config-editor-header">
                                    <h4 id="configEditorTitle">Edit Configuration</h4>
                                    <div class="config-editor-actions">
                                        <button class="btn btn-sm btn-success" onclick="saveDockerConfig()">üíæ Save</button>
                                        <button class="btn btn-sm btn-warning" onclick="saveDockerConfigAndRestart()">üíæ Save & Restart Docker</button>
                                        <button class="btn btn-sm" onclick="closeDockerConfigEditor()">‚úñ Close</button>
                                    </div>
                                </div>
                                <div class="config-editor-path" id="configEditorPath">/path/to/file</div>
                                <textarea id="dockerConfigContent" class="config-editor" placeholder="Loading configuration..."></textarea>
                                <div class="config-editor-hint">
                                    <span>üí° Tip: Invalid JSON in daemon.json will prevent Docker from starting. Use the validator below.</span>
                                    <button class="btn btn-sm" onclick="validateDockerConfig()">‚úì Validate</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Container List Card -->
                <div class="card full-height">
                    <div class="card-header">
                        <h2>üê≥ Docker Containers</h2>
                        <div class="card-actions">
                            <button class="btn btn-sm btn-success" onclick="dockerAction('up')" title="Start all containers (docker compose up -d)">‚ñ∂Ô∏è Start All</button>
                            <button class="btn btn-sm btn-danger" onclick="dockerAction('down')" title="Stop all containers (docker compose down)">‚èπÔ∏è Stop All</button>
                            <button class="btn btn-sm btn-primary" onclick="dockerUpdateAll()" title="Pull latest images and recreate containers">‚¨ÜÔ∏è Update All</button>
                            <button class="btn btn-sm btn-warning" onclick="dockerForceRebuild()" title="Force rebuild all containers (no cache)">üî® Force Rebuild</button>
                        </div>
                    </div>
                    <div class="card-body">
                        <!-- Bulk Actions Panel -->
                        <div class="bulk-actions-panel" id="bulkActionsPanel">
                            <div class="bulk-action-item">
                                <button class="btn btn-sm" onclick="dockerAction('restart')" title="Restart all running containers">
                                    üîÑ Restart All
                                </button>
                            </div>
                            <div class="bulk-action-item">
                                <button class="btn btn-sm" onclick="dockerAction('pull')" title="Pull latest images without restarting">
                                    ‚¨áÔ∏è Pull Images
                                </button>
                            </div>
                            <div class="bulk-action-item">
                                <button class="btn btn-sm" onclick="dockerPrune()" title="Remove unused containers, networks, and images">
                                    üßπ Docker Prune
                                </button>
                            </div>
                            <div class="bulk-action-item">
                                <button class="btn btn-sm" onclick="loadContainerUpdates()" title="Check all containers for updates">
                                    üîç Check Updates
                                </button>
                            </div>
                        </div>
                        
                        <!-- Container List -->
                        <div id="containerDetailList" class="container-detail-list">
                            <div class="loading">Loading containers...</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Setup & Config Page -->
            <div id="page-setup" class="page">
                <!-- Setup Status Overview -->
                <div class="stats-grid setup-stats-grid">
                    <div class="stat-card" id="setupStatusCard">
                        <div class="stat-icon" id="setupStatusIcon">‚öôÔ∏è</div>
                        <div class="stat-info">
                            <div class="stat-value" id="setupStatus">Checking...</div>
                            <div class="stat-label">Setup Status</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">üìÑ</div>
                        <div class="stat-info">
                            <div class="stat-value" id="configsStatus">-/-</div>
                            <div class="stat-label">Config Files</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">üîë</div>
                        <div class="stat-info">
                            <div class="stat-value" id="envVarsStatus">-/-</div>
                            <div class="stat-label">Env Variables</div>
                        </div>
                    </div>
                    <div class="stat-card" id="gitStatusCard">
                        <div class="stat-icon" id="gitStatusIcon">üì¶</div>
                        <div class="stat-info">
                            <div class="stat-value" id="gitStatus">-</div>
                            <div class="stat-label">Repository</div>
                        </div>
                    </div>
                </div>
                
                <div class="setup-tabs">
                    <button class="setup-tab active" onclick="showSetupTab('github')">üì¶ GitHub</button>
                    <button class="setup-tab" onclick="showSetupTab('configs')">üìÑ Configs</button>
                    <button class="setup-tab" onclick="showSetupTab('env')">‚öôÔ∏è Config Status</button>
                    <button class="setup-tab" onclick="showSetupTab('scripts')">üöÄ Setup Scripts</button>
                </div>
                
                <!-- GitHub Manager Tab -->
                <div id="setup-tab-github" class="setup-tab-content active">
                    <div class="dashboard-grid github-grid">
                        <!-- Repository Status -->
                        <div class="card">
                            <div class="card-header">
                                <h2>üì¶ Repository Status</h2>
                                <button class="btn btn-sm" onclick="loadGitStatus()">üîÑ Refresh</button>
                            </div>
                            <div class="card-body">
                                <div id="gitRepoStatus" class="git-status">
                                    <div class="loading">Loading...</div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Quick Actions -->
                        <div class="card">
                            <div class="card-header">
                                <h2>‚ö° Quick Actions</h2>
                            </div>
                            <div class="card-body">
                                <div class="git-actions">
                                    <button class="btn btn-primary btn-lg" onclick="gitPullAndRestart()">
                                        üîÑ Pull & Restart
                                        <span class="btn-hint">Update code and restart Shellder</span>
                                    </button>
                                    <button class="btn btn-lg" onclick="gitPullOnly()">
                                        üì• Pull Only
                                        <span class="btn-hint">Download updates without restart</span>
                                    </button>
                                    <button class="btn btn-warning btn-lg" onclick="restartShellder()">
                                        üîÉ Restart Shellder
                                        <span class="btn-hint">Restart without pulling</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Recent Commits -->
                    <div class="card">
                        <div class="card-header">
                            <h2>üìú Recent Commits</h2>
                        </div>
                        <div class="card-body">
                            <div id="recentCommits" class="commits-list">
                                <div class="loading">Loading...</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Changed Files -->
                    <div class="card" id="changedFilesCard" style="display: none;">
                        <div class="card-header">
                            <h2>üìù Local Changes</h2>
                            <span class="badge badge-warning" id="changesCount">0 files</span>
                        </div>
                        <div class="card-body">
                            <div id="changedFiles" class="changes-list"></div>
                        </div>
                    </div>
                </div>
                
                <!-- Config Files Tab -->
                <div id="setup-tab-configs" class="setup-tab-content">
                    <div class="card">
                        <div class="card-header">
                            <h2>üìÑ Configuration Files</h2>
                            <button class="btn btn-sm" onclick="loadConfigFiles()">üîÑ Refresh</button>
                        </div>
                        <div class="card-body">
                            <div id="configFilesList" class="config-files-list">
                                <div class="loading">Loading...</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Structured Config Editor Panel -->
                    <div id="configEditorPanel" class="config-editor-panel" style="display: none;">
                        <div class="config-panel-header">
                            <div class="config-panel-title">
                                <h3 id="configEditorTitle">üìù Edit Config</h3>
                                <span id="configEditorPath" class="config-path-label"></span>
                            </div>
                            <div class="config-panel-actions">
                                <button class="btn btn-sm" onclick="toggleRawEditor()" id="toggleRawBtn">üìÑ Raw Mode</button>
                                <button class="btn btn-sm" onclick="closeConfigEditor()">‚úñ Close</button>
                            </div>
                        </div>
                        
                        <!-- Form-based Editor -->
                        <div id="configFormEditor" class="config-form-editor">
                            <div id="configFieldsContainer" class="config-fields-container">
                                <!-- Config fields loaded dynamically -->
                            </div>
                        </div>
                        
                        <!-- Raw Text Editor (hidden by default) -->
                        <div id="configRawEditor" class="config-raw-editor" style="display: none;">
                            <textarea id="configEditorContent" class="config-editor" placeholder="Loading..."></textarea>
                        </div>
                        
                        <div class="config-panel-footer">
                            <div class="config-footer-info">
                                <span id="configEditorStatus"></span>
                            </div>
                            <div class="config-footer-actions">
                                <button class="btn btn-secondary btn-sm" onclick="closeConfigEditor()">Cancel</button>
                                <button class="btn btn-success btn-sm" onclick="saveConfigFile()">üíæ Save Changes</button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Config Variables Status Tab -->
                <div id="setup-tab-env" class="setup-tab-content">
                    <div class="card">
                        <div class="card-header">
                            <h2>‚öôÔ∏è Config Variables Status</h2>
                            <div class="card-actions">
                                <button class="btn btn-sm" onclick="loadConfigVariablesStatus()">üîÑ Refresh</button>
                            </div>
                        </div>
                        <div class="card-body">
                            <!-- Summary Stats -->
                            <div id="configVarsSummary" class="config-vars-summary">
                                <div class="summary-item">
                                    <span class="summary-icon">üìä</span>
                                    <span id="configVarsTotal">-</span>
                                    <span class="summary-label">Total</span>
                                </div>
                                <div class="summary-item success">
                                    <span class="summary-icon">‚úÖ</span>
                                    <span id="configVarsConfigured">-</span>
                                    <span class="summary-label">Configured</span>
                                </div>
                                <div class="summary-item warning">
                                    <span class="summary-icon">‚ö†Ô∏è</span>
                                    <span id="configVarsMissing">-</span>
                                    <span class="summary-label">Missing</span>
                                </div>
                                <div class="summary-item synced">
                                    <span class="summary-icon">üîó</span>
                                    <span id="configVarsSynced">-</span>
                                    <span class="summary-label">Synced</span>
                                </div>
                                <div class="summary-item error">
                                    <span class="summary-icon">‚ùå</span>
                                    <span id="configVarsMismatched">-</span>
                                    <span class="summary-label">Mismatched</span>
                                </div>
                            </div>
                            
                            <!-- Legend -->
                            <div class="config-vars-legend">
                                <span class="legend-item"><span class="status-dot synced"></span> Synced across configs</span>
                                <span class="legend-item"><span class="status-dot mismatch"></span> Values don't match</span>
                                <span class="legend-item"><span class="status-dot empty"></span> Not set</span>
                                <span class="legend-item">üîó = Shared variable</span>
                            </div>
                            
                            <!-- Config Variables by Category -->
                            <div id="configVarsCategories" class="config-vars-categories">
                                <div class="loading">Loading configuration status...</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Stack Setup Wizard Tab -->
                <div id="setup-tab-scripts" class="setup-tab-content">
                    <!-- Start Prompt - Shown before wizard starts -->
                    <div id="wizardStartPrompt" class="wizard-start-prompt">
                        <div class="start-prompt-icon">üßô‚Äç‚ôÇÔ∏è</div>
                        <h2>Stack Setup Wizard</h2>
                        <p>This wizard will guide you through setting up your Aegis AIO stack step by step.</p>
                        <ul class="wizard-features">
                            <li>‚úÖ Check Docker & Docker Compose</li>
                            <li>‚úÖ Verify port availability</li>
                            <li>‚úÖ Detect system resources</li>
                            <li>‚úÖ Configure files and passwords</li>
                            <li>‚úÖ Optimize database settings</li>
                            <li>‚úÖ Start the stack</li>
                        </ul>
                        <button class="btn btn-lg btn-success" onclick="startWizard()">
                            üöÄ Start Setup Wizard
                        </button>
                    </div>
                    
                    <!-- Wizard Content - Hidden until user starts -->
                    <div id="wizardContent" style="display: none;">
                        <!-- Wizard Progress Header -->
                        <div class="wizard-header">
                            <div class="wizard-title">
                                <h2>üßô‚Äç‚ôÇÔ∏è Stack Setup Wizard</h2>
                                <p>Configure your Aegis AIO stack step by step</p>
                            </div>
                            <div class="wizard-progress-bar">
                                <div id="wizardProgressFill" class="progress-fill" style="width: 0%"></div>
                            </div>
                            <div class="wizard-progress-text">
                                <span id="wizardProgressText">0% Complete</span>
                                <button class="btn btn-sm btn-primary" onclick="refreshWizardStatus()">üîÑ Refresh</button>
                            </div>
                        </div>
                    
                    <!-- Wizard Steps Grid -->
                    <div class="wizard-steps-grid">
                        <!-- Step 1: Docker -->
                        <div class="wizard-step-card" id="wizard-step-docker">
                            <div class="step-header">
                                <div class="step-number">1</div>
                                <div class="step-status" id="step-docker-status">‚è≥</div>
                            </div>
                            <div class="step-icon">üê≥</div>
                            <div class="step-name">Docker & Compose</div>
                            <div class="step-desc">Container runtime environment</div>
                            <div class="step-details" id="step-docker-details">Checking...</div>
                            <button class="btn btn-sm btn-primary step-action" onclick="runWizardStep('docker')">Install Docker</button>
                        </div>
                        
                        <!-- Step 2: Port Check -->
                        <div class="wizard-step-card" id="wizard-step-ports">
                            <div class="step-header">
                                <div class="step-number">2</div>
                                <div class="step-status" id="step-ports-status">‚è≥</div>
                            </div>
                            <div class="step-icon">üîå</div>
                            <div class="step-name">Port Availability</div>
                            <div class="step-desc">Check required ports are free</div>
                            <div class="step-details" id="step-ports-details">Checking...</div>
                            <button class="btn btn-sm btn-primary step-action" onclick="runWizardStep('ports')">Check Ports</button>
                        </div>
                        
                        <!-- Step 3: System Resources -->
                        <div class="wizard-step-card" id="wizard-step-resources">
                            <div class="step-header">
                                <div class="step-number">3</div>
                                <div class="step-status" id="step-resources-status">‚è≥</div>
                            </div>
                            <div class="step-icon">üíª</div>
                            <div class="step-name">System Resources</div>
                            <div class="step-desc">Detect RAM, CPU, storage</div>
                            <div class="step-details" id="step-resources-details">Checking...</div>
                            <button class="btn btn-sm btn-primary step-action" onclick="runWizardStep('resources')">Detect</button>
                        </div>
                        
                        <!-- Step 4: Config Files -->
                        <div class="wizard-step-card" id="wizard-step-configs">
                            <div class="step-header">
                                <div class="step-number">4</div>
                                <div class="step-status" id="step-configs-status">‚è≥</div>
                            </div>
                            <div class="step-icon">üìÅ</div>
                            <div class="step-name">Config Files</div>
                            <div class="step-desc">Copy example configs</div>
                            <div class="step-details" id="step-configs-details">Checking...</div>
                            <button class="btn btn-sm btn-primary step-action" onclick="runWizardStep('configs')">Copy Configs</button>
                        </div>
                        
                        <!-- Step 5: Passwords -->
                        <div class="wizard-step-card" id="wizard-step-passwords">
                            <div class="step-header">
                                <div class="step-number">5</div>
                                <div class="step-status" id="step-passwords-status">‚è≥</div>
                            </div>
                            <div class="step-icon">üîê</div>
                            <div class="step-name">Passwords</div>
                            <div class="step-desc">Generate secure credentials</div>
                            <div class="step-details" id="step-passwords-details">Checking...</div>
                            <button class="btn btn-sm btn-primary step-action" onclick="togglePasswordPanel()">Configure</button>
                        </div>
                        
                        <!-- Password Configuration Panel (Pop-out) -->
                        <div id="passwordPanel" class="wizard-popout-panel" style="display: none;">
                            <div class="popout-header">
                                <h3>üîê Password Configuration</h3>
                                <button class="btn btn-sm" onclick="closePasswordPanel()">‚úï Close</button>
                            </div>
                            <div id="passwordPanelStatus" class="popout-status"></div>
                            <div class="popout-body">
                                <div id="passwordFieldsContainer" class="password-fields-list">
                                    <!-- Password fields loaded dynamically -->
                                </div>
                            </div>
                            <div class="popout-footer">
                                <label class="show-passwords-label">
                                    <input type="checkbox" id="showPasswordsCheckbox" onchange="togglePasswordVisibility()">
                                    Show values
                                </label>
                                <div class="popout-actions">
                                    <button class="btn btn-secondary btn-sm" onclick="generateAllPasswords()">üé≤ Generate All New</button>
                                    <button class="btn btn-success btn-sm" onclick="applyPasswordChoices()">üíæ Save Passwords</button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Step 6: MariaDB Setup -->
                        <div class="wizard-step-card" id="wizard-step-mariadb">
                            <div class="step-header">
                                <div class="step-number">6</div>
                                <div class="step-status" id="step-mariadb-status">‚è≥</div>
                            </div>
                            <div class="step-icon">üóÑÔ∏è</div>
                            <div class="step-name">MariaDB Setup</div>
                            <div class="step-desc">Database setup & optimization</div>
                            <div class="step-details" id="step-mariadb-details">Checking...</div>
                            <button class="btn btn-sm btn-primary step-action" onclick="runWizardStep('mariadb_setup')">Setup</button>
                        </div>
                        
                        <!-- Step 7: Docker Logging -->
                        <div class="wizard-step-card" id="wizard-step-logging">
                            <div class="step-header">
                                <div class="step-number">7</div>
                                <div class="step-status" id="step-logging-status">‚è≥</div>
                            </div>
                            <div class="step-icon">üìã</div>
                            <div class="step-name">Docker Logging</div>
                            <div class="step-desc">Log rotation config</div>
                            <div class="step-details" id="step-logging-details">Checking...</div>
                            <button class="btn btn-sm btn-primary step-action" onclick="runWizardStep('logging')">Configure</button>
                        </div>
                        
                        <!-- Step 8: Start Stack -->
                        <div class="wizard-step-card wizard-step-final" id="wizard-step-start">
                            <div class="step-header">
                                <div class="step-number">8</div>
                                <div class="step-status" id="step-start-status">‚è≥</div>
                            </div>
                            <div class="step-icon">üöÄ</div>
                            <div class="step-name">Start Stack</div>
                            <div class="step-desc">Launch containers</div>
                            <div class="step-details" id="step-start-details">Complete steps first</div>
                            <button class="btn btn-sm btn-success step-action" id="startStackBtn" onclick="runWizardStep('start')" disabled>üöÄ Start</button>
                        </div>
                    </div>
                    
                    <!-- Wizard Output Panel -->
                    <div id="wizardOutputPanel" class="wizard-output-panel" style="display: none;">
                        <div class="wizard-output-header">
                            <span id="wizardOutputTitle">Step Output</span>
                            <button class="btn btn-sm" onclick="closeWizardOutput()">‚úñ Close</button>
                        </div>
                        <div id="wizardOutputContent" class="wizard-output-content"></div>
                    </div>
                    
                    <!-- Quick Actions -->
                    <div class="wizard-quick-actions">
                        <h3>‚ö° Quick Actions (Interactive Terminal)</h3>
                        <div class="quick-actions-grid">
                            <button class="btn btn-secondary" onclick="runSetupScript('setup.sh')">üîß Full Setup Script</button>
                            <button class="btn btn-secondary" onclick="runSetupScript('check.sh')">‚úÖ Health Check</button>
                            <button class="btn btn-secondary" onclick="runSetupScript('dbsetup.sh')">üóÑÔ∏è DB Setup</button>
                            <button class="btn btn-secondary" onclick="runSetupScript('nginx-setup.sh')">üîí Nginx Setup</button>
                        </div>
                    </div>
                    
                    <!-- Interactive Terminal for Scripts -->
                    <div id="scriptTerminalCard" class="script-terminal-card" style="display: none;">
                        <div class="script-terminal-header">
                            <span id="scriptTerminalTitle">üñ•Ô∏è Interactive Terminal</span>
                            <div class="terminal-controls">
                                <span id="terminalStatus" class="terminal-status">Disconnected</span>
                                <button class="btn btn-sm btn-warning" onclick="stopTerminalSession()" title="Stop Script">‚èπÔ∏è Stop</button>
                                <button class="btn btn-sm" onclick="closeTerminal()">‚úñ Close</button>
                            </div>
                        </div>
                        <div class="terminal-hint">
                            üí° <strong>Interactive terminal</strong> - Type your responses and press Enter. Use Ctrl+C to cancel.
                        </div>
                        <div id="terminalContainer" class="terminal-container"></div>
                    </div>
                    </div><!-- End wizardContent -->
                </div>
            </div>
            
            <!-- Scripts Page -->
            <div id="page-scripts" class="page">
                <div class="card">
                    <div class="card-header">
                        <h2>Shellder Scripts</h2>
                        <p class="card-subtitle">Run scripts via terminal for full interactivity</p>
                    </div>
                    <div class="card-body">
                        <div class="scripts-grid">
                            <div class="script-card" onclick="showScriptInfo('setup.sh')">
                                <div class="script-icon">üöÄ</div>
                                <div class="script-name">Initial Setup</div>
                                <div class="script-desc">First-time configuration</div>
                            </div>
                            <div class="script-card" onclick="showScriptInfo('dbsetup.sh')">
                                <div class="script-icon">üóÑÔ∏è</div>
                                <div class="script-name">Database Manager</div>
                                <div class="script-desc">MariaDB setup & maintenance</div>
                            </div>
                            <div class="script-card" onclick="showScriptInfo('nginx-setup.sh')">
                                <div class="script-icon">üîí</div>
                                <div class="script-name">Security Setup</div>
                                <div class="script-desc">Nginx & SSL configuration</div>
                            </div>
                            <div class="script-card" onclick="showScriptInfo('check.sh')">
                                <div class="script-icon">‚úÖ</div>
                                <div class="script-name">System Check</div>
                                <div class="script-desc">Verify configuration</div>
                            </div>
                            <div class="script-card" onclick="showScriptInfo('logs.sh')">
                                <div class="script-icon">üìã</div>
                                <div class="script-name">Log Manager</div>
                                <div class="script-desc">View Docker logs</div>
                            </div>
                            <div class="script-card" onclick="showScriptInfo('files.sh')">
                                <div class="script-icon">üìÅ</div>
                                <div class="script-name">File Manager</div>
                                <div class="script-desc">Git & file operations</div>
                            </div>
                            <div class="script-card" onclick="showScriptInfo('poracle.sh')">
                                <div class="script-icon">üîî</div>
                                <div class="script-name">Poracle Setup</div>
                                <div class="script-desc">Notification system</div>
                            </div>
                            <div class="script-card" onclick="showScriptInfo('fletchling.sh')">
                                <div class="script-icon">üê¶</div>
                                <div class="script-name">Fletchling Setup</div>
                                <div class="script-desc">Quest scanning</div>
                            </div>
                        </div>
                        
                        <div class="terminal-hint">
                            <div class="hint-icon">üí°</div>
                            <div class="hint-text">
                                <strong>To run scripts with full interactivity:</strong>
                                <code>sudo bash shellder.sh</code>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Logs Page -->
            <div id="page-logs" class="page">
                <div class="card full-height">
                    <div class="card-header">
                        <h2>Shellder Logs</h2>
                        <div class="card-actions">
                            <select id="logLines" onchange="loadShellderLogs()">
                                <option value="50">Last 50 lines</option>
                                <option value="100" selected>Last 100 lines</option>
                                <option value="200">Last 200 lines</option>
                                <option value="500">Last 500 lines</option>
                            </select>
                            <button class="btn btn-sm" onclick="loadShellderLogs()">Refresh</button>
                        </div>
                    </div>
                    <div class="card-body">
                        <pre id="logContent" class="log-viewer">Loading logs...</pre>
                    </div>
                </div>
            </div>
            
            <!-- Updates Page -->
            <div id="page-updates" class="page">
                <div class="card">
                    <div class="card-header">
                        <h2>Updates</h2>
                    </div>
                    <div class="card-body">
                        <div id="gitStatus" class="git-status">
                            <div class="loading">Checking for updates...</div>
                        </div>
                        
                        <div class="update-actions">
                            <button class="btn btn-primary" onclick="gitPull()">
                                <span>‚¨áÔ∏è</span> Pull Updates
                            </button>
                        </div>
                        
                        <div id="updateOutput" class="update-output" style="display: none;">
                            <pre></pre>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Nginx & Sites Page -->
            <div id="page-nginx" class="page">
                <!-- Nginx Status Bar -->
                <div class="control-bar">
                    <div class="control-bar-left">
                        <span class="control-label">Nginx Status:</span>
                        <span class="container-status-badge" id="nginxStatus">
                            <span class="status-dot"></span>
                            <span class="status-text">Checking...</span>
                        </span>
                    </div>
                    <div class="control-bar-right">
                        <button class="btn btn-success btn-sm" onclick="nginxAction('start')">‚ñ∂Ô∏è Start</button>
                        <button class="btn btn-warning btn-sm" onclick="nginxAction('reload')">üîÑ Reload</button>
                        <button class="btn btn-danger btn-sm" onclick="nginxAction('stop')">‚èπÔ∏è Stop</button>
                        <button class="btn btn-sm" onclick="nginxAction('test')">‚úì Test Config</button>
                    </div>
                </div>
                
                <div class="stats-grid nginx-stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon success">üåê</div>
                        <div class="stat-info">
                            <div class="stat-value" id="sitesEnabled">-</div>
                            <div class="stat-label">Sites Enabled</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">üìÅ</div>
                        <div class="stat-info">
                            <div class="stat-value" id="sitesAvailable">-</div>
                            <div class="stat-label">Sites Available</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon success">üîí</div>
                        <div class="stat-info">
                            <div class="stat-value" id="sslCerts">-</div>
                            <div class="stat-label">SSL Certificates</div>
                        </div>
                    </div>
                    <div class="stat-card clickable" onclick="testAllSites()">
                        <div class="stat-icon" id="siteHealthIcon">üîç</div>
                        <div class="stat-info">
                            <div class="stat-value" id="siteHealth">--</div>
                            <div class="stat-label">Sites Healthy</div>
                        </div>
                    </div>
                </div>
                
                <div class="dashboard-grid nginx-grid">
                    <!-- Sites Enabled -->
                    <div class="card">
                        <div class="card-header">
                            <h2>‚úÖ Sites Enabled</h2>
                            <span class="text-muted">sites-enabled</span>
                        </div>
                        <div class="card-body">
                            <div id="sitesEnabledList" class="sites-list">
                                <div class="loading">Loading sites...</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Sites Available (Disabled) -->
                    <div class="card">
                        <div class="card-header">
                            <h2>üìÅ Sites Available</h2>
                            <span class="text-muted">sites-available (disabled)</span>
                        </div>
                        <div class="card-body">
                            <div id="sitesAvailableList" class="sites-list">
                                <div class="loading">Loading sites...</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Site Editor -->
                <div class="card">
                    <div class="card-header">
                        <h2>üìù Site Configuration</h2>
                        <div class="card-actions">
                            <select id="siteSelector" onchange="loadSiteConfig(this.value)">
                                <option value="">Select a site to edit...</option>
                            </select>
                            <button class="btn btn-sm btn-success" onclick="saveSiteConfig()">üíæ Save</button>
                        </div>
                    </div>
                    <div class="card-body">
                        <textarea id="siteConfigEditor" class="config-editor" placeholder="Select a site to edit its configuration..."></textarea>
                    </div>
                </div>
                
                <!-- Quick Setup -->
                <div class="card">
                    <div class="card-header">
                        <h2>üöÄ Quick Nginx Setup</h2>
                        <span class="text-muted">Create SSL certificates and configure sites</span>
                    </div>
                    <div class="card-body">
                        <div class="nginx-setup-form">
                            <div class="form-group">
                                <label>Domain Name:</label>
                                <input type="text" id="setupDomain" placeholder="example.com" class="form-input">
                            </div>
                            <div class="form-group">
                                <label>Email (for SSL):</label>
                                <input type="email" id="setupEmail" placeholder="admin@example.com" class="form-input">
                            </div>
                            <div class="form-group">
                                <label>Service to Proxy:</label>
                                <select id="setupService" class="form-input">
                                    <option value="reactmap:6001">ReactMap (Port 6001)</option>
                                    <option value="koji:6002">Koji (Port 6002)</option>
                                    <option value="dragonite:6003">Dragonite (Port 6003)</option>
                                    <option value="rotom:6004">Rotom (Port 6004)</option>
                                    <option value="golbat:6005">Golbat (Port 6005)</option>
                                    <option value="grafana:3000">Grafana (Port 3000)</option>
                                    <option value="shellder:5000">Shellder (Port 5000)</option>
                                    <option value="custom">Custom Port...</option>
                                </select>
                            </div>
                            <div class="form-group" id="customPortGroup" style="display: none;">
                                <label>Custom Port:</label>
                                <input type="number" id="setupCustomPort" placeholder="8080" class="form-input">
                            </div>
                            <div class="form-actions">
                                <button class="btn btn-primary" onclick="runNginxSetup()">üîß Setup Site with SSL</button>
                                <button class="btn btn-sm" onclick="generateConfigPreview()">üëÅÔ∏è Preview Config</button>
                            </div>
                        </div>
                        <div id="nginxSetupOutput" class="setup-output" style="display: none;">
                            <pre></pre>
                        </div>
                    </div>
                </div>
                
                <!-- Error Log -->
                <div class="card">
                    <div class="card-header">
                        <h2>üìã Nginx Error Log</h2>
                        <button class="btn btn-sm" onclick="loadNginxLogs()">üîÑ Refresh</button>
                    </div>
                    <div class="card-body">
                        <pre id="nginxLogContent" class="log-viewer">Loading nginx logs...</pre>
                    </div>
                </div>
                
                <!-- Security Services Section -->
                <div class="section-divider">
                    <h2>üõ°Ô∏è Security Services</h2>
                    <p class="text-muted">Firewall, intrusion prevention, and authentication controls</p>
                </div>
                
                <!-- Security Status Overview -->
                <div class="stats-grid security-stats-grid">
                    <div class="stat-card" id="ufwStatusCard">
                        <div class="stat-icon" id="ufwStatusIcon">üî•</div>
                        <div class="stat-info">
                            <div class="stat-value" id="ufwStatus">-</div>
                            <div class="stat-label">UFW Firewall</div>
                        </div>
                    </div>
                    <div class="stat-card" id="fail2banStatusCard">
                        <div class="stat-icon" id="fail2banStatusIcon">üö´</div>
                        <div class="stat-info">
                            <div class="stat-value" id="fail2banStatus">-</div>
                            <div class="stat-label">Fail2Ban</div>
                        </div>
                    </div>
                    <div class="stat-card" id="autheliaStatusCard">
                        <div class="stat-icon" id="autheliaStatusIcon">üîë</div>
                        <div class="stat-info">
                            <div class="stat-value" id="autheliaStatus">-</div>
                            <div class="stat-label">Authelia SSO</div>
                        </div>
                    </div>
                    <div class="stat-card" id="basicAuthStatusCard">
                        <div class="stat-icon">üë§</div>
                        <div class="stat-info">
                            <div class="stat-value" id="basicAuthStatus">-</div>
                            <div class="stat-label">Basic Auth Users</div>
                        </div>
                    </div>
                </div>
                
                <div class="dashboard-grid security-grid">
                    <!-- UFW Firewall -->
                    <div class="card">
                        <div class="card-header">
                            <h2>üî• UFW Firewall</h2>
                            <div class="card-actions">
                                <button class="btn btn-success btn-sm" onclick="ufwAction('enable')">‚úì Enable</button>
                                <button class="btn btn-danger btn-sm" onclick="ufwAction('disable')">‚úó Disable</button>
                                <button class="btn btn-sm" onclick="ufwAction('reload')">üîÑ Reload</button>
                            </div>
                        </div>
                        <div class="card-body">
                            <div id="ufwRules" class="rules-list">
                                <div class="loading">Loading firewall rules...</div>
                            </div>
                            <div class="add-rule-form" style="margin-top: 15px; padding-top: 15px; border-top: 1px solid var(--border-color);">
                                <h4>Add Rule</h4>
                                <div class="form-row">
                                    <select id="ufwRuleType" class="form-input form-input-sm">
                                        <option value="allow">Allow</option>
                                        <option value="deny">Deny</option>
                                    </select>
                                    <input type="text" id="ufwRulePort" placeholder="Port (e.g., 22, 80)" class="form-input form-input-sm">
                                    <select id="ufwRuleProtocol" class="form-input form-input-sm">
                                        <option value="tcp">TCP</option>
                                        <option value="udp">UDP</option>
                                        <option value="">Both</option>
                                    </select>
                                    <button class="btn btn-primary btn-sm" onclick="addUfwRule()">‚ûï Add</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Fail2Ban -->
                    <div class="card">
                        <div class="card-header">
                            <h2>üö´ Fail2Ban</h2>
                            <div class="card-actions">
                                <button class="btn btn-success btn-sm" onclick="fail2banAction('start')">‚ñ∂Ô∏è Start</button>
                                <button class="btn btn-warning btn-sm" onclick="fail2banAction('restart')">üîÑ Restart</button>
                                <button class="btn btn-danger btn-sm" onclick="fail2banAction('stop')">‚èπÔ∏è Stop</button>
                            </div>
                        </div>
                        <div class="card-body">
                            <div id="fail2banJails" class="jails-list">
                                <div class="loading">Loading fail2ban status...</div>
                            </div>
                            <div class="unban-form" style="margin-top: 15px; padding-top: 15px; border-top: 1px solid var(--border-color);">
                                <h4>Unban IP</h4>
                                <div class="form-row">
                                    <input type="text" id="unbanIp" placeholder="IP Address" class="form-input form-input-sm">
                                    <select id="unbanJail" class="form-input form-input-sm">
                                        <option value="sshd">sshd</option>
                                        <option value="nginx-http-auth">nginx-http-auth</option>
                                    </select>
                                    <button class="btn btn-warning btn-sm" onclick="unbanIp()">üîì Unban</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Authelia SSO -->
                    <div class="card">
                        <div class="card-header">
                            <h2>üîë Authelia SSO</h2>
                            <div class="card-actions">
                                <button class="btn btn-success btn-sm" onclick="autheliaAction('start')">‚ñ∂Ô∏è Start</button>
                                <button class="btn btn-warning btn-sm" onclick="autheliaAction('restart')">üîÑ Restart</button>
                                <button class="btn btn-danger btn-sm" onclick="autheliaAction('stop')">‚èπÔ∏è Stop</button>
                            </div>
                        </div>
                        <div class="card-body">
                            <div id="autheliaInfo" class="authelia-info">
                                <div class="loading">Loading Authelia status...</div>
                            </div>
                            <div class="authelia-links" style="margin-top: 15px;">
                                <a href="/authelia" target="_blank" class="btn btn-sm">üåê Open Authelia Portal</a>
                                <button class="btn btn-sm" onclick="loadAutheliaLogs()">üìã View Logs</button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Basic Auth -->
                    <div class="card">
                        <div class="card-header">
                            <h2>üë§ Basic Auth (htpasswd)</h2>
                            <button class="btn btn-sm" onclick="loadBasicAuthUsers()">üîÑ Refresh</button>
                        </div>
                        <div class="card-body">
                            <div id="basicAuthUsers" class="users-list">
                                <div class="loading">Loading users...</div>
                            </div>
                            <div class="add-user-form" style="margin-top: 15px; padding-top: 15px; border-top: 1px solid var(--border-color);">
                                <h4>Add/Update User</h4>
                                <div class="form-row">
                                    <input type="text" id="htpasswdUsername" placeholder="Username" class="form-input form-input-sm">
                                    <input type="password" id="htpasswdPassword" placeholder="Password" class="form-input form-input-sm">
                                    <button class="btn btn-primary btn-sm" onclick="addBasicAuthUser()">‚ûï Add</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- SSL Certificates -->
                <div class="card">
                    <div class="card-header">
                        <h2>üîí SSL Certificates</h2>
                        <div class="card-actions">
                            <button class="btn btn-sm" onclick="loadSslCertificates()">üîÑ Refresh</button>
                            <button class="btn btn-warning btn-sm" onclick="renewAllCerts()">üîÑ Renew All</button>
                        </div>
                    </div>
                    <div class="card-body">
                        <div id="sslCertsList" class="certs-list">
                            <div class="loading">Loading certificates...</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Stack Data Page - Cross-Referenced Database Stats -->
            <div id="page-stack" class="page">
                <!-- Connection Status -->
                <div class="stack-connection" id="stackConnection">
                    <div class="loading">Connecting to stack database...</div>
                </div>
                
                <!-- Main Stats Grid -->
                <div class="stats-grid stack-stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon success">üìç</div>
                        <div class="stat-info">
                            <div class="stat-value" id="stackPokemon">-</div>
                            <div class="stat-label">Active Pokemon</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">üë§</div>
                        <div class="stat-info">
                            <div class="stat-value" id="stackAccounts">-</div>
                            <div class="stat-label">Active Accounts</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">üì±</div>
                        <div class="stat-info">
                            <div class="stat-value" id="stackDevices">-</div>
                            <div class="stat-label">Online Devices</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">‚ö°</div>
                        <div class="stat-info">
                            <div class="stat-value" id="stackEfficiency">-</div>
                            <div class="stat-label">Pokemon/Hour</div>
                        </div>
                    </div>
                </div>
                
                <div class="dashboard-grid stack-grid">
                    <!-- Scanner Health -->
                    <div class="card">
                        <div class="card-header">
                            <h2>üéÆ Scanner Overview</h2>
                            <button class="btn btn-sm btn-icon" onclick="refreshStackData()">üîÑ</button>
                        </div>
                        <div class="card-body">
                            <div id="scannerStats" class="scanner-stats">
                                <div class="loading">Loading scanner data...</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Account Health -->
                    <div class="card">
                        <div class="card-header">
                            <h2>üë§ Account Health</h2>
                        </div>
                        <div class="card-body">
                            <div id="accountStats" class="account-stats">
                                <div class="loading">Loading account data...</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Map Data -->
                    <div class="card">
                        <div class="card-header">
                            <h2>üó∫Ô∏è Map Data (Golbat)</h2>
                        </div>
                        <div class="card-body">
                            <div id="golbatStats" class="golbat-stats">
                                <div class="loading">Loading Golbat data...</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Geofencing -->
                    <div class="card">
                        <div class="card-header">
                            <h2>üìê Geofencing (Koji)</h2>
                        </div>
                        <div class="card-body">
                            <div id="kojiStats" class="koji-stats">
                                <div class="loading">Loading Koji data...</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Device List -->
                <div class="card full-width">
                    <div class="card-header">
                        <h2>üì± Connected Devices</h2>
                        <span class="device-count" id="deviceCount">0 devices</span>
                    </div>
                    <div class="card-body">
                        <div id="deviceList" class="device-list">
                            <div class="loading">Loading device list...</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Devices Page - Comprehensive Device Management -->
            <div id="page-devices" class="page">
                <!-- Summary Stats -->
                <div class="stats-grid device-stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon success">üì±</div>
                        <div class="stat-info">
                            <div class="stat-value" id="devicesOnline">-</div>
                            <div class="stat-label">Online</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon stopped">‚èπÔ∏è</div>
                        <div class="stat-info">
                            <div class="stat-value" id="devicesOffline">-</div>
                            <div class="stat-label">Offline</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon danger">üí•</div>
                        <div class="stat-info">
                            <div class="stat-value" id="devicesCrashes24h">-</div>
                            <div class="stat-label">Crashes (24h)</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">‚è±Ô∏è</div>
                        <div class="stat-info">
                            <div class="stat-value" id="devicesAvgUptime">-</div>
                            <div class="stat-label">Avg Uptime</div>
                        </div>
                    </div>
                </div>
                
                <div class="devices-layout">
                    <!-- Device List -->
                    <div class="card devices-list-card">
                        <div class="card-header">
                            <h2>üì± Device Status</h2>
                            <div class="card-actions">
                                <input type="text" id="deviceSearch" placeholder="Search devices..." class="search-input">
                                <button class="btn btn-sm btn-icon" onclick="refreshDevices()">üîÑ</button>
                            </div>
                        </div>
                        <div class="card-body">
                            <div id="devicesList" class="devices-table-container">
                                <div class="loading">Loading devices...</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Crash History -->
                    <div class="card crashes-card">
                        <div class="card-header">
                            <h2>üí• Recent Crashes</h2>
                            <select id="crashDeviceFilter" onchange="filterCrashes()">
                                <option value="">All Devices</option>
                            </select>
                        </div>
                        <div class="card-body">
                            <div id="crashList" class="crash-list">
                                <div class="loading">Loading crashes...</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Live Activity Feed -->
                <div class="card activity-card full-width">
                    <div class="card-header">
                        <h2>‚ö° Live Activity</h2>
                        <div class="card-actions">
                            <span class="monitor-status" id="monitorStatus">
                                <span class="status-dot offline"></span>
                                <span>Stopped</span>
                            </span>
                            <button class="btn btn-sm" id="monitorToggle" onclick="toggleMonitor()">
                                ‚ñ∂Ô∏è Start
                            </button>
                            <select id="activityFilter" onchange="filterActivity()">
                                <option value="">All Events</option>
                                <option value="error">Errors</option>
                                <option value="warning">Warnings</option>
                                <option value="success">Success</option>
                            </select>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="activity-layout">
                            <!-- Container Health -->
                            <div class="container-health" id="containerHealth">
                                <div class="health-header">Container Status</div>
                                <div class="health-grid" id="healthGrid">
                                    <div class="loading">Loading...</div>
                                </div>
                            </div>
                            
                            <!-- Activity Stream -->
                            <div class="activity-stream" id="activityStream">
                                <div class="stream-hint">
                                    Click "Start" to begin real-time monitoring
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Log Context Viewer Modal -->
                <div id="logContextModal" class="modal" style="display:none;">
                    <div class="modal-content large">
                        <div class="modal-header">
                            <h3>üìú Log Context</h3>
                            <button class="btn btn-icon close-modal" onclick="closeLogModal()">‚úï</button>
                        </div>
                        <div class="modal-body">
                            <div class="log-context-info">
                                <span id="logContextDevice"></span>
                                <span id="logContextType"></span>
                                <span id="logContextTime"></span>
                            </div>
                            <div class="log-context-controls">
                                <button class="btn btn-sm" onclick="loadMoreContext(-50)">‚¨ÜÔ∏è Earlier</button>
                                <span id="logContextRange"></span>
                                <button class="btn btn-sm" onclick="loadMoreContext(50)">‚¨áÔ∏è Later</button>
                            </div>
                            <pre id="logContextContent" class="log-viewer"></pre>
                        </div>
                    </div>
                </div>
                
                <!-- Device Detail Modal -->
                <div id="deviceDetailModal" class="modal" style="display:none;">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h3>üì± Device Details</h3>
                            <button class="btn btn-icon close-modal" onclick="closeDeviceModal()">‚úï</button>
                        </div>
                        <div class="modal-body">
                            <div id="deviceDetailContent">
                                <div class="loading">Loading...</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Xilriws Page -->
            <div id="page-xilriws" class="page">
                <!-- Container Control Bar -->
                <div class="control-bar">
                    <div class="control-bar-left">
                        <span class="control-label">Xilriws Container:</span>
                        <span class="container-status-badge" id="xilriwsContainerStatus">
                            <span class="status-dot"></span>
                            <span class="status-text">Checking...</span>
                        </span>
                    </div>
                    <div class="control-bar-right">
                        <button class="btn btn-success btn-sm" onclick="xilriwsAction('start')" title="Start Xilriws">‚ñ∂Ô∏è Start</button>
                        <button class="btn btn-warning btn-sm" onclick="xilriwsAction('restart')" title="Restart Xilriws">üîÑ Restart</button>
                        <button class="btn btn-danger btn-sm" onclick="xilriwsAction('stop')" title="Stop Xilriws">‚èπÔ∏è Stop</button>
                    </div>
                </div>
                
                <!-- Main Stats -->
                <div class="stats-grid xilriws-stats-grid">
                    <div class="stat-card large">
                        <div class="stat-icon success">‚úì</div>
                        <div class="stat-info">
                            <div class="stat-value" id="xilSuccessRate">--%</div>
                            <div class="stat-label">Overall Success Rate</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon success">üë§</div>
                        <div class="stat-info">
                            <div class="stat-value" id="xilAccountSuccessRate">--%</div>
                            <div class="stat-label">Account Success</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon success">üåê</div>
                        <div class="stat-info">
                            <div class="stat-value" id="xilProxySuccessRate">--%</div>
                            <div class="stat-label">Proxy Success</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon success">üü¢</div>
                        <div class="stat-info">
                            <div class="stat-value" id="xilSuccessful">-</div>
                            <div class="stat-label">Successful Auth</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon danger">üî¥</div>
                        <div class="stat-info">
                            <div class="stat-value" id="xilFailed">-</div>
                            <div class="stat-label">Failed</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">üìä</div>
                        <div class="stat-info">
                            <div class="stat-value" id="xilTotal">-</div>
                            <div class="stat-label">Total Requests</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon warning">üç™</div>
                        <div class="stat-info">
                            <div class="stat-value" id="xilCookieStatus">-/-</div>
                            <div class="stat-label">Cookie Storage</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon" id="criticalIcon">‚ö†Ô∏è</div>
                        <div class="stat-info">
                            <div class="stat-value" id="xilCritical">0</div>
                            <div class="stat-label">Critical Events</div>
                        </div>
                    </div>
                </div>
                
                <div class="dashboard-grid xilriws-grid">
                    <!-- Error Breakdown - Updated categories -->
                    <div class="card">
                        <div class="card-header">
                            <h2>üî¥ Error Breakdown</h2>
                        </div>
                        <div class="card-body">
                            <div id="xilErrorBreakdown" class="error-breakdown">
                                <div class="error-section">
                                    <h4>Account Status</h4>
                                    <div class="error-row">
                                        <span class="error-type">üö´ Account Banned (418)</span>
                                        <span class="error-count" id="xilAuthBanned">0</span>
                                    </div>
                                    <div class="error-row">
                                        <span class="error-type">üîÑ Max Retries Exceeded</span>
                                        <span class="error-count" id="xilMaxRetries">0</span>
                                    </div>
                                    <div class="error-row">
                                        <span class="error-type">üí• Internal Server Error</span>
                                        <span class="error-count" id="xilInternalError">0</span>
                                    </div>
                                </div>
                                <div class="error-section">
                                    <h4>Browser Issues</h4>
                                    <div class="error-row">
                                        <span class="error-type">üõ°Ô∏è Bot Protection (Code 15)</span>
                                        <span class="error-count" id="xilCode15">0</span>
                                    </div>
                                    <div class="error-row">
                                        <span class="error-type">‚è±Ô∏è Page Timeout</span>
                                        <span class="error-count" id="xilBrowserTimeout">0</span>
                                    </div>
                                    <div class="error-row">
                                        <span class="error-type">üåê Page Unreachable</span>
                                        <span class="error-count" id="xilBrowserUnreachable">0</span>
                                    </div>
                                    <div class="error-row">
                                        <span class="error-type">‚è≥ JS Challenge Timeout</span>
                                        <span class="error-count" id="xilJSTimeout">0</span>
                                    </div>
                                </div>
                                <div class="error-section">
                                    <h4>Connection Issues</h4>
                                    <div class="error-row">
                                        <span class="error-type">üöá Tunnel Failed (407)</span>
                                        <span class="error-count" id="xilTunnelFailed">0</span>
                                    </div>
                                    <div class="error-row">
                                        <span class="error-type">‚è∞ Connection Timeout</span>
                                        <span class="error-count" id="xilConnTimeout">0</span>
                                    </div>
                                    <div class="error-row">
                                        <span class="error-type">üîê Captcha Triggered</span>
                                        <span class="error-count" id="xilCaptcha">0</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Proxy Stats -->
                    <div class="card">
                        <div class="card-header">
                            <h2>üåê Proxy Performance</h2>
                            <span class="badge" id="currentProxyBadge">Current: --</span>
                        </div>
                        <div class="card-body">
                            <div id="proxyStats" class="proxy-stats-container">
                                <div class="loading">Loading proxy stats...</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Recent Errors -->
                <div class="card">
                    <div class="card-header">
                        <h2>‚ö° Recent Errors</h2>
                        <span class="badge error-badge" id="errorCount">0 errors</span>
                    </div>
                    <div class="card-body">
                        <div id="recentErrors" class="recent-errors-list">
                            <div class="no-data">No recent errors</div>
                        </div>
                    </div>
                </div>
                
                <!-- Proxy Manager -->
                <div class="card">
                    <div class="card-header">
                        <h2>üìù Proxy Manager</h2>
                        <div class="card-actions">
                            <button class="btn btn-sm" onclick="loadProxyFile()" title="Reload from file">üîÑ Reload</button>
                            <button class="btn btn-sm btn-success" onclick="saveProxies()" title="Save changes">üíæ Save</button>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="proxy-manager">
                            <div class="proxy-info">
                                <p>Edit proxies below (one per line). Format: <code>host:port</code> or <code>user:pass@host:port</code></p>
                                <p class="text-muted">File: <code id="proxyFilePath">xilriws/proxies.txt</code> | <span id="proxyCount">0</span> proxies loaded</p>
                            </div>
                            <textarea id="proxyEditor" class="proxy-editor" placeholder="Loading proxies..."></textarea>
                            <div class="proxy-actions">
                                <button class="btn btn-warning" onclick="saveAndRestartXilriws()">üíæ Save & Restart Xilriws</button>
                                <button class="btn btn-sm" onclick="validateProxies()">‚úì Validate Format</button>
                                <button class="btn btn-sm btn-danger" onclick="clearProxies()">üóëÔ∏è Clear All</button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Live Logs -->
                <div class="card full-height">
                    <div class="card-header">
                        <h2>üìú Live Xilriws Logs</h2>
                        <div class="card-actions">
                            <select id="logFilter" class="log-filter" onchange="filterXilriwsLogs()">
                                <option value="all">All Logs</option>
                                <option value="success">Success Only</option>
                                <option value="error">Errors Only</option>
                                <option value="warning">Warnings Only</option>
                                <option value="proxy">Proxy Events</option>
                            </select>
                            <label class="toggle-label">
                                <input type="checkbox" id="xilLiveToggle" onchange="toggleXilriwsLive()" checked>
                                <span>Auto-scroll</span>
                            </label>
                            <button class="btn btn-sm" onclick="loadXilriwsLogs()">Refresh</button>
                        </div>
                    </div>
                    <div class="card-body">
                        <pre id="xilriwsLogContent" class="log-viewer live-log">Connecting to Xilriws logs...</pre>
                    </div>
                </div>
            </div>
            
            <!-- Statistics Page -->
            <div id="page-stats" class="page">
                <div class="card">
                    <div class="card-header">
                        <h2>Historical Statistics</h2>
                        <div class="card-actions">
                            <select id="statsTimeRange" onchange="loadHistoricalStats()">
                                <option value="1">Last 24 hours</option>
                                <option value="7" selected>Last 7 days</option>
                                <option value="30">Last 30 days</option>
                            </select>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="stats-chart-container">
                            <canvas id="statsChart"></canvas>
                        </div>
                    </div>
                </div>
                
                <div class="dashboard-grid">
                    <div class="card">
                        <div class="card-header">
                            <h2>All-Time Proxy Stats</h2>
                        </div>
                        <div class="card-body">
                            <div id="allTimeProxyStats" class="stats-table-container">
                                <table class="stats-table">
                                    <thead>
                                        <tr>
                                            <th>Proxy</th>
                                            <th>Total</th>
                                            <th>Success</th>
                                            <th>Failed</th>
                                            <th>Rate</th>
                                        </tr>
                                    </thead>
                                    <tbody id="proxyStatsBody">
                                        <tr><td colspan="5" class="loading">Loading...</td></tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card-header">
                            <h2>Recent System Events</h2>
                        </div>
                        <div class="card-body">
                            <div id="systemEvents" class="event-list">
                                <div class="loading">Loading events...</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <h2>Container Uptime History</h2>
                    </div>
                    <div class="card-body">
                        <div id="containerHistory" class="container-history">
                            <div class="loading">Loading container history...</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Files Page -->
            <div id="page-files" class="page">
                <div class="card full-height">
                    <div class="card-header">
                        <h2>File Browser</h2>
                        <div class="card-actions">
                            <button class="btn btn-sm" onclick="navigateToPath('')">üè† Root</button>
                            <button class="btn btn-sm" onclick="navigateUp()">‚¨ÜÔ∏è Up</button>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="file-path-bar">
                            <span class="path-label">Path:</span>
                            <span id="currentPath" class="current-path">/</span>
                        </div>
                        <div id="fileList" class="file-list">
                            <div class="loading">Loading files...</div>
                        </div>
                    </div>
                </div>
                
                <!-- File Viewer Modal Content -->
                <div id="fileViewer" class="file-viewer" style="display: none;">
                    <div class="file-viewer-header">
                        <span id="fileViewerName">filename.txt</span>
                        <button class="btn btn-sm" onclick="closeFileViewer()">‚úï Close</button>
                    </div>
                    <pre id="fileViewerContent" class="file-content"></pre>
                </div>
            </div>
        </main>
    </div>
    
    <!-- Modal -->
    <div id="modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">Title</h3>
                <button class="modal-close" onclick="closeModal()">&times;</button>
            </div>
            <div class="modal-body" id="modalBody">
                Content
            </div>
            <div class="modal-footer" id="modalFooter">
            </div>
        </div>
    </div>
    
    <!-- Toast Container -->
    <div id="toastContainer" class="toast-container"></div>
    
    <!-- Socket.IO for WebSocket support -->
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <script src="/static/script.js"></script>
</body>
</html>


